{"code":"!function(e){var o={};function t(s){if(o[s])return o[s].exports;var n=o[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=o,t.d=function(e,o,s){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:s})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&\"object\"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:e}),2&o&&\"string\"!=typeof e)for(var n in e)t.d(s,n,function(o){return e[o]}.bind(null,n));return s},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,\"a\",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p=\"\",t(t.s=39)}({12:function(e){e.exports=JSON.parse('{\"fbAPIHostname\":\"https://www.facebook.com\",\"mfbAPIHostname\":\"https://m.facebook.com\",\"businessfbAPIHostname\":\"https://business.facebook.com\",\"mBasicUrl\":\"https://mbasic.facebook.com\"}')},33:function(e,o,t){\"use strict\";t.r(o),t.d(o,\"fbDtsg\",(function(){return a})),t.d(o,\"fbAccessToken\",(function(){return i})),t.d(o,\"fbGrabRouteData\",(function(){return c})),t.d(o,\"fbGrabRouteMultiData\",(function(){return d})),t.d(o,\"aboutUs\",(function(){return l}));var s=(e,o=!1)=>{let t=e.replace(/for\\s*\\(\\s*;\\s*;\\s*\\)\\s*;\\s*/,\"\");o&&(t=t.replace(/for \\(;;\\);/g,\"\"));let s=o?t.split(/\\r\\n/g):t.split(/\\}\\r\\n *\\{/);return 1===s.length||o?s:\"[\"+s.join(\"},{\")+\"]\"},n=t(12);const r={routeDefinition:n.fbAPIHostname+\"/ajax/route-definition/\",bulkRouteDefinition:n.fbAPIHostname+\"/ajax/bulk-route-definitions/\",businessPage:n.businessfbAPIHostname+\"/creatorstudio/home\",loggedUserData:n.mfbAPIHostname+\"/composer/ocelot/async_loader/?publisher=feed\"},a=(e,o=null,t=null)=>{fetch(r.loggedUserData,{method:\"GET\"}).then(e=>e.text()).then(t=>{let s,n,r=\"\",a=\"\",i=\"\",c=\"\",d=!1;const l=/\\\\\"suggestions\\\\\":\\[\\{[^}]*\\}/gm,u=/\\\\\"dtsg\\\\\":\\{[^}]*\\}/gm;null!=t.match(u)&&(n=t.match(u)[0],n=\"{\"+n.replace(/[\\\\]/g,\"\")+\"}\",n=JSON.parse(n).dtsg);let p={};if(l.test(t)){s=t.match(l)[0],s=\"{\"+s.replace(/[\\\\]/g,\"\")+\"]}\",s=JSON.parse(s).suggestions[0],console.log(\"sugest in login helper\",s);let e=s.path.includes(\"profile.php\")?s.uid:s.path.replace(\"/\",\"\");i=s.uid,r=e,a=s.text,c=s.photo,d=!0,p={FacebookId:i,FacebookUsername:r,FacebookName:a,FacebookImage:c,LoggedInFacebook:d,dtsg:n}}else d=!1,p={FacebookId:i,FacebookUsername:r,FacebookName:a,FacebookImage:c,LoggedInFacebook:d,dtsg:n};if(\"function\"!=typeof o)return{data:e,dtsg:n,sugest:s,parameters:p};o({data:e,dtsg:n,sugest:s,parameters:p})}).catch(()=>{o&&o(e,null,t)})},i=(e=null)=>{fetch(r.businessPage,{method:\"GET\",mode:\"cors\",headers:{authority:\"business.facebook.com\",\"Content-Type\":\"application/x-www-form-urlencoded\",Accept:\"text/html,application/json\"}}).then(e=>e.text()).then(o=>{const t=o.match(/\"userAccessToken\":\"(.*?)\"/);if(t&&Array.isArray(t)){let o=t[1];e(o,t)}}).catch(()=>{e&&e(null)})},c=async(e,o,t,n=null)=>{var a=new FormData;return a.append(\"fb_dtsg\",e),a.append(\"route_url\",o),a.append(\"client_previous_actor_id\",t),a.append(\"__user\",t),a.append(\"routing_namespace\",\"fb_comet\"),a.append(\"__comet_req\",1),a.append(\"__a\",1),a.append(\"dpr\",1),await fetch(r.routeDefinition,{body:a,headers:{accept:\"application/json, text/plain, */*\"},method:\"POST\"}).then(e=>e.text()).then(e=>{let o=s(e,!0);if(\"function\"!=typeof n)return{text:o.length?o[0]:\"\",parseAble:s(e),loggedUserId:t};n({text:o.length?o[0]:\"\",parseAble:o},t)})},d=async(e,o,t,n=null)=>{var a=new FormData;a.append(\"fb_dtsg\",e),o.forEach((e,o)=>{a.append(`route_urls[${o}]`,e)}),a.append(\"client_previous_actor_id\",t),a.append(\"__user\",t),a.append(\"routing_namespace\",\"fb_comet\"),a.append(\"__comet_req\",1),a.append(\"__a\",1),a.append(\"dpr\",1),fetch(r.routeDefinition,{body:a,headers:{accept:\"application/json, text/plain, */*\"},method:\"POST\"}).then(e=>e.text()).then(e=>{let o=s(e,!0);if(\"function\"!=typeof n)return{text:o.length?o[0]:\"\",parseAble:s(e),userId:userId};n({text:o.length?o[0]:\"\",parseAble:o},userId)})},l=(e,o=null)=>{a(null,o=>{d(o.dtsg,e,o.parameters.FacebookId,e=>{})})}},34:function(e,o,t){const{fbGrabRouteData:s}=t(33),n=(e,o,t)=>{try{let s={av:e,__user:e,__a:1,dpr:1,fb_dtsg:o,fb_api_caller_class:\"RelayModern\",fb_api_req_friendly_name:\"FriendingCometFriendsListPaginationQuery\",variables:JSON.stringify({count:30,cursor:t,name:null,scale:1}),server_timestamps:!0,doc_id:5393753507311167},n=[];for(let e in s)s.hasOwnProperty(e)&&n.push(encodeURIComponent(e)+\"=\"+encodeURIComponent(s[e]));return n.join(\"&\")}catch(e){}};e.exports={ScrapFacebookFriends:async function(e){let o=await n(e.FBuserId,e.dtsg,e.cursor);return new Promise((t,s)=>{setTimeout(()=>{fetch(\"https://www.facebook.com/api/graphql/\",{method:\"POST\",headers:{\"Content-Type\":\"application/x-www-form-urlencoded\",Accept:\"text/html,application/json\",\"x-fb-friendly-name\":\"FriendingCometFriendsListPaginationQuery\"},body:o}).then(async o=>{let n=await o.json();n.hasOwnProperty(\"data\")?(console.log(\"==========3==================\",n.data),n.data.hasOwnProperty(\"viewer\")?(console.log(\"==========4==================\",n.data.viewer),n.data.viewer.hasOwnProperty(\"all_friends\")?(console.log(\"===========5=================\",n.data.viewer.all_friends),n.data.viewer.hasOwnProperty(\"all_friends\")?n.data.viewer.all_friends.hasOwnProperty(\"edges\")?n.data.viewer.all_friends.hasOwnProperty(\"page_info\")?t({success:!0,count:0,kyubi_user_token:e.kyubi_user_token,User_id:e.User_id,friends:n.data.viewer.all_friends.edges,end_cursor:n.data.viewer.all_friends.page_info.end_cursor,has_next_page:n.data.viewer.all_friends.page_info.has_next_page}):(t({success:!0,count:0,kyubi_user_token:e.kyubi_user_token,User_id:e.User_id,friends:n.data.viewer.all_friends.edges,end_cursor:\"\",has_next_page:!1}),s({success:!1,count:1})):s({success:!1,count:2}):s({success:!1,count:3})):s({success:!1,count:4})):s({success:!1,count:5})):s({success:!1,count:6})}).catch(e=>{console.log(\"Friend Counts Error\",e),s({success:!1,count:7})})},5e3)})},fetchCollectionToken:async(e,o,t)=>{const n=\"\"===t||Number.isInteger(parseInt(t))?`profile.php?id=${o}&sk=friends_all`:`/${t}/friends_all`;return new Promise(async(t,r)=>{try{const r=(await s(e,n,o)).text.match(/\"collectionToken\":\"(.*?)\"/);if(r&&Array.isArray(r)){t(r[1])}}catch(e){r(e)}})},ScrapSlowFacebookFriends:async function(e){console.log(\"ScrapSlowFacebookFriends\",e);const o=((e,o,t,s)=>{try{let n={av:e,__user:e,__a:1,dpr:1,fb_dtsg:o,fb_api_caller_class:\"RelayModern\",fb_api_req_friendly_name:\"ProfileCometAppCollectionListRendererPaginationQuery\",variables:JSON.stringify({count:20,cursor:t,search:null,scale:1,id:s}),server_timestamps:!0,doc_id:0xd8dac09faf5cd},r=[];for(let e in n)n.hasOwnProperty(e)&&r.push(encodeURIComponent(e)+\"=\"+encodeURIComponent(n[e]));return r.join(\"&\")}catch(e){}})(e.FBuserId,e.dtsg,e.cursor,e.collectionToken);return new Promise((t,s)=>{setTimeout(()=>{fetch(\"https://www.facebook.com/api/graphql/\",{method:\"POST\",headers:{Accept:\"*/*\",\"content-type\":\"application/x-www-form-urlencoded\"},body:o}).then(async o=>{let n=await o.json();n.hasOwnProperty(\"data\")?(console.log(\"==========33==================\",n.data),n.data.hasOwnProperty(\"node\")?(console.log(\"==========44==================\",n.data.node),n.data.node.hasOwnProperty(\"pageItems\")?(console.log(\"===========55=================\",n.data.node.pageItems),n.data.node.pageItems.hasOwnProperty(\"edges\")?(console.log(\"===========66=================\",n.data.node.pageItems.edges),n.data.node.pageItems.hasOwnProperty(\"page_info\")?t({success:!0,count:0,kyubi_user_token:e.kyubi_user_token,User_id:e.User_id,friends:n.data.node.pageItems.edges,end_cursor:n.data.node.pageItems.page_info.end_cursor,has_next_page:n.data.node.pageItems.page_info.has_next_page}):(t({success:!0,count:0,kyubi_user_token:e.kyubi_user_token,User_id:e.User_id,friends:n.data.node.pageItems.edges,end_cursor:\"\",has_next_page:!1}),s({success:!1,count:1}))):s({success:!1,count:3})):s({success:!1,count:4})):s({success:!1,count:5})):s({success:!1,count:6})}).catch(e=>{console.log(\"Friend Counts Error\",e),s({success:!1,count:7})})},5e3)})},ScrapNewSlowFacebookFriends:async function(e){let o=await n(e.FBuserId,e.dtsg,e.cursor,e.collectionToken);return console.log(o),new Promise((t,s)=>{setTimeout(()=>{fetch(\"https://www.facebook.com/api/graphql/\",{method:\"POST\",headers:{\"Content-Type\":\"application/x-www-form-urlencoded\",Accept:\"text/html,application/json\",\"x-fb-friendly-name\":\"FriendingCometFriendsListPaginationQuery\"},body:o}).then(async o=>{let n=await o.json();n.hasOwnProperty(\"data\")?(console.log(\"==========3==================\",n.data),n.data.hasOwnProperty(\"viewer\")?(console.log(\"==========4==================\",n.data.viewer),n.data.viewer.hasOwnProperty(\"all_friends\")?(console.log(\"===========5=================\",n.data.viewer.all_friends),n.data.viewer.hasOwnProperty(\"all_friends\")?n.data.viewer.all_friends.hasOwnProperty(\"edges\")?n.data.viewer.all_friends.hasOwnProperty(\"page_info\")?t({success:!0,count:0,kyubi_user_token:e.kyubi_user_token,User_id:e.User_id,friends:n.data.viewer.all_friends.edges,end_cursor:n.data.viewer.all_friends.page_info.end_cursor,has_next_page:n.data.viewer.all_friends.page_info.has_next_page}):(t({success:!0,count:0,kyubi_user_token:e.kyubi_user_token,User_id:e.User_id,friends:n.data.viewer.all_friends.edges,end_cursor:\"\",has_next_page:!1}),s({success:!1,count:1})):s({success:!1,count:2}):s({success:!1,count:3})):s({success:!1,count:4})):s({success:!1,count:5})):s({success:!1,count:6})}).catch(e=>{console.log(\"Friend Counts Error\",e),s({success:!1,count:7})})},2e3)})},fetchFacebookFriendDetails:async function(e){await serializeFBFDetails(e.FriendFacebookid,e.ProfileURL,e.UserFacebookId,e.UserdtsgToken)},getAboutFriend:e=>{console.log(\"This is x\",e);let o=\"\";o=-1!=e.ProfileURL.indexOf(\"?id=\")?e.ProfileURL+\"&sk=about_overview\":e.ProfileURL+\"/about_overview\"}}},39:function(e,o,t){\"use strict\";t.r(o);var s=t(34),n=t(33);var r=e=>JSON.stringify(e);const a=\"post\";chrome.storage.local.set({tabInfo:{isBlocked:!1,tabId:0},isFirstTime:!0});const i=(e,o,t)=>fetch(\"http://localhost:8081\"+e,{method:o,headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":!0},body:t});chrome.runtime.onMessageExternal.addListener((async function(e,o,t){if(console.log(\"This is the Sender\",o),console.log(\"This is the request\",e),console.log(\"This is the sendResponse\",t),\"GetUserFaceBookAuth\"===e.type&&Object(n.fbDtsg)(null,async o=>{if(o.parameters.LoggedInFacebook){console.log(\"GetUserFaceBookAuth: Logged in User Data\",o.parameters),console.log(\"GetUserFaceBookAuth: DTSG\",o.dtsg);let t=await Object(s.fetchCollectionToken)(o.parameters.dtsg.token,o.parameters.FacebookId,o.parameters.FacebookUsername);console.log(\"GetUserFaceBookAuth: Collection Token\",t);let n={user_id:e.options._id,kyubi_user_token:e.options.kyubi_user_token,UserFacebookName:o.parameters.FacebookName,UserFacebookid:o.parameters.FacebookId,UserdtsgToken:o.parameters.dtsg.token,UserFacebookImage:o.parameters.FacebookImage,UserFacebookUsername:o.parameters.FacebookUsername,UserdtsgExpire:o.parameters.dtsg.expire,access_token:o.dtsg,UsercollectionToken:t};await i(\"/api/user/CheckThenStoreProfileInfo\",a,r(n)).then(async e=>{console.log(\"GetUserFaceBookAuth: Response from server\",e),await e.json()}).catch(e=>{})}else{let o={user_id:e.options._id,kyubi_user_token:e.options.kyubi_user_token,UserFacebookName:!1,UserFacebookid:!1,UserdtsgToken:!1,UserFacebookImage:!1,UserFacebookUsername:!1,UserdtsgExpire:!1,access_token:!1};await i(\"/api/user/CheckThenStoreProfileInfo\",a,r(o)).then(async e=>{console.log(\"GetUserFaceBookAuth: Response from server in else part\",e),await e.json()}).catch(e=>{})}}),\"GetFacebookFriends\"===e.type){let o={dtsg:e.options.UserdtsgToken,FBuserId:e.options.UserFacebookid,kyubi_user_token:e.options.kyubi_user_token,User_id:e.options._id,cursor:e.options.end_cursor,collectionToken:e.options.UsercollectionToken,profileId:e.options.UserProfileId};await async function e(o,t=!0){await Object(s.ScrapFacebookFriends)(o).then(async s=>{if(console.log(\"GetFacebookFriends::CallBaseFacebookAPIToGetFriend ===>\",s),!0===s.success){let n=[],c={};if(await s.friends.map(async e=>{n.push({friend:e.node}),c={dtsg:o.dtsg,FBuserId:o.FBuserId,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,cursor:e.cursor,collectionToken:o.collectionToken,profileId:o.profileId}}),!0===s.has_next_page){let d={totalFriends:0,friends:n,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,has_next_page:s.has_next_page,FBuserId:o.FBuserId,profileId:o.profileId};t&&await i(\"/api/friend/StoreUserFriends\",a,r(d)).then(async e=>{console.log(\"GetFacebookFriends::CallBaseFacebookAPIToGetFriend: Response from server\",e),await e.json()}).catch(e=>{console.log(\"GetFacebookFriends::CallBaseFacebookAPIToGetFriend: found error in fetching the Profile Info\",e)}),await e(c,t)}else{let d={totalFriends:0,friends:n,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,has_next_page:s.has_next_page,FBuserId:o.FBuserId,profileId:o.profileId};t?await i(\"/api/friend/StoreUserFriends\",a,r(d)).then(async e=>{console.log(\"GetFacebookFriends::CallBaseFacebookAPIToGetFriend: Response from server to save data after last data from facebook\",e),await e.json();let t={dtsg:o.dtsg,FBuserId:o.FBuserId,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,cursor:null,collectionToken:o.collectionToken,profileId:o.profileId};console.log(\"SlowNewpayload\",t),await async function e(o){await ScrapSlowFacebookFriends(o).then(async t=>{if(console.log(\"This Is what I got from Facebook =============\",t),!0===t.success){let s=[],n={};if(await t.friends.map(async e=>{s.push({friend:e.node}),n={dtsg:o.dtsg,FBuserId:o.FBuserId,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,cursor:e.cursor,collectionToken:o.collectionToken,profileId:o.profileId}}),!0===t.has_next_page){let c={totalFriends:0,friends:s,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,has_next_page:t.has_next_page,FBuserId:o.FBuserId,profileId:o.profileId};await i(\"/api/friend/StoreUserFriends\",a,r(c)).then(async e=>{console.log(\"This is the Data I have To Send Back\",e);await e.json()}).catch(e=>{console.log(\"We are really Sorry we found error in fetching the Profile Info\",e)}),await e(n)}else{let e={totalFriends:0,friends:s,kyubi_user_token:o.kyubi_user_token,User_id:o.User_id,has_next_page:t.has_next_page,FBuserId:o.FBuserId};await i(\"/api/friend/StoreUserFriends\",a,r(e)).then(async e=>{console.log(\"This is the Data I have To Send Back\",e);await e.json(),o.dtsg,o.FBuserId,o.kyubi_user_token,o.User_id,o.collectionToken,o.profileId}).catch(e=>{console.log(\"We are really Sorry we found error in fetching the Profile Info\",e)}),console.log(\"This are the friends Request i have\",s)}}})}(t)}).catch(e=>{console.log(\"We are really Sorry we found error in fetching the Profile Info\",e)}):(c.cursor=null,await e(c)),console.log(\"This are the friends Request i have\",n)}}})}(o,!1)}\"GetFriendsFaceBookDetails\"===e.type&&(console.log(e.options),await e.options.map(async(e,o)=>{20===o&&(console.log(\"This is the Friend Info\",e),await getAboutFriend(e))}))}))}});","extractedComments":[]}